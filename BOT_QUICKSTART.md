# 微信战报机器人 - 快速开始指南

## 🚀 5分钟快速上手

### 步骤1：安装依赖

```bash
npm install wechaty wechaty-puppet-wechat file-box
```

**注意**：
- 如果安装失败，尝试使用国内镜像：
  ```bash
  npm install wechaty wechaty-puppet-wechat file-box --registry=https://registry.npmmirror.com
  ```

---

### 步骤2：配置授权用户

编辑 `scripts/wechat-bot.js` 文件，找到第15行：

```javascript
const CONFIG = {
  AUTHORIZED_USERS: [
    '河伯', // ← 改成您的微信昵称
    // '张三',  // 添加其他授权用户
  ],
  DATA_DIR: path.join(__dirname, '..'),
};
```

**如何查看微信昵称**：
1. 打开微信
2. 点击右下角"我"
3. 查看顶部的昵称

---

### 步骤3：启动机器人

```bash
npm run bot
```

首次运行会显示二维码：

```
╔══════════════════════════════════════╗
║   🤖 河伯战报机器人已启动            ║
╚══════════════════════════════════════╝

📱 请使用微信扫描二维码登录

[QR CODE 图像]
```

**扫码登录**：
1. 用微信扫描屏幕上的二维码
2. 手机上确认登录
3. 看到提示 "机器人已启动" 即成功

---

### 步骤4：在微信中使用

打开微信，向"文件传输助手"或自己发送：

#### 4.1 创建新战报

```
/new 党校队
```

**机器人回复**：
```
✅ 已创建新战报

📅 日期: 2026-01-15
⚽ 对手: 党校队

接下来请：
📝 发送文本 - 比赛描述
📸 发送图片 - 比赛照片
⚙️  /info <地点> <比分> <MVP> - 设置信息
✅  /finish - 完成并生成战报
```

#### 4.2 发送比赛描述

```
元旦假期福沁大对决,知己VS党校,
两队精锐尽出,展开一场跌宕起伏的
友好交流赛。
```

**机器人回复**：
```
✅ 已记录内容，继续发送或使用 /finish 完成
```

#### 4.3 发送比赛照片

直接发送图片即可！

**机器人回复**：
```
📸 已保存照片 1: photo-001.jpg
```

可以连续发送多张照片，会自动编号。

#### 4.4 设置比赛信息

```
/info 福沁球场 20-26 高主席
```

**机器人回复**：
```
✅ 已更新比赛信息：

📍 地点: 福沁球场
🎯 比分: 20-26
⭐ MVP: 高主席

当前已记录:
📝 1 段文字
📸 5 张照片
```

#### 4.5 完成战报

```
/finish
```

**机器人回复**：
```
🎉 战报生成成功！

📁 文件名: 2026-01-15-党校队.md
📝 标题: 2026-01-15 vs 党校队
📸 照片: 5张
📍 地点: 福沁球场
🎯 比分: 20-26
⭐ MVP: 高主席

下一步：
npm run publish:ins    # Ins风格（内战推荐）
npm run publish:battle # 热血风格（外战推荐）
```

---

### 步骤5：发布到公众号

生成战报后，在命令行运行：

```bash
# 外战使用热血风格
npm run publish:battle

# 内战使用Ins风格
npm run publish:ins
```

浏览器会自动打开预览，复制到微信公众号即可！

---

## 📋 完整命令列表

| 命令 | 说明 | 示例 |
|------|------|------|
| `/new <对手>` | 创建新战报 | `/new 党校队` |
| `/info <地点> <比分> <MVP>` | 设置信息 | `/info 福沁球场 3-2 张三` |
| `/finish` | 完成并生成战报 | `/finish` |
| `/status` | 查看当前状态 | `/status` |
| `/cancel` | 取消当前战报 | `/cancel` |
| `/publish` | 自动生成微信文章 | `/publish` |
| `/help` | 显示帮助 | `/help` |

---

## 🎯 实际使用示例

### 场景1：完整流程

```
你: /new 三海风

机器人: ✅ 已创建新战报...

你: 冬日不虚度，晴光忽满帘，周六上午
    知己队再战福沁球场。

机器人: ✅ 已记录内容...

你: [发送照片1]

机器人: 📸 已保存照片 1: photo-001.jpg

你: [发送照片2]

机器人: 📸 已保存照片 2: photo-002.jpg

你: /info 福沁球场 3-2 东哥

机器人: ✅ 已更新比赛信息...

你: /finish

机器人: 🎉 战报生成成功！...
```

### 场景2：多段描述

```
你: /new 内战

你: 首发阵容：
    蓝队：辉哥、托蒂、王书记
    红队：张航、小王、东哥

机器人: ✅ 已记录内容...

你: 上半场红队先发制人，
    小王连入两球建立优势。

机器人: ✅ 已记录内容...

你: 下半场蓝队奋起直追，
    托蒂帽子戏法逆转比赛！

机器人: ✅ 已记录内容...

你: /finish

机器人: 🎉 战报生成成功！...
```

---

## ⚠️ 常见问题

### 1. 安装失败

**问题**：`npm install` 报错

**解决方案**：
```bash
# 使用国内镜像
npm config set registry https://registry.npmmirror.com
npm install wechaty wechaty-puppet-wechat file-box
```

### 2. 机器人无法启动

**问题**：启动后立即退出

**解决方案**：
- 检查Node.js版本：`node --version`（需要 >= 14）
- 重新安装依赖：`rm -rf node_modules && npm install`

### 3. 扫码后无反应

**问题**：扫描二维码后没有提示

**解决方案**：
- 等待10-20秒
- 检查网络连接
- 重新启动机器人

### 4. 收不到消息

**问题**：发送消息后机器人没反应

**解决方案**：
- 确认微信昵称已在配置中
- 尝试发送 `/help` 测试连接
- 查看机器人控制台日志

### 5. 照片保存失败

**问题**：发送照片后提示保存失败

**解决方案**：
- 检查 `photos/` 目录权限
- 确保磁盘空间充足
- 查看控制台错误信息

---

## 🔧 高级配置

### 1. 添加授权用户

```javascript
// scripts/wechat-bot.js
AUTHORIZED_USERS: [
  '河伯',
  '张三',  // 添加队友
  '李四',  // 添加教练
],
```

### 2. 修改默认数据目录

```javascript
// scripts/wechat-bot.js
DATA_DIR: 'D:/足球战报',  // 改成自定义路径
```

### 3. 自动选择发布风格

编辑 `/publish` 命令逻辑：

```javascript
// 在 publishMatch 函数中
const command = 'npm run publish:battle';  // 默认热血风格
```

---

## 🚀 部署到服务器

### 使用PM2保持运行

```bash
# 安装PM2
npm install -g pm2

# 启动机器人
pm2 start scripts/wechat-bot.js --name match-bot

# 查看日志
pm2 logs match-bot

# 设置开机自启
pm2 startup
pm2 save
```

---

## 💡 使用技巧

### 1. 批量处理

可以先收集所有聊天记录和照片，然后一次性发送：

```
你: /new 党校队

你: [粘贴整段聊天记录]

机器人: ✅ 已记录内容...

你: [连续发送10张照片]

机器人: 📸 已保存照片 1-10...

你: /info 福沁球场 20-26 高主席

你: /finish
```

### 2. 快速修改

如果发现信息填错，可以：

```
你: /status  # 查看当前状态

你: /info 福沁球场 20-26 高主席  # 重新设置

你: /finish  # 完成并覆盖原文件
```

### 3. 模板使用

创建常用模板：

```bash
# 创建模板脚本
echo '/new 外战
/info 福沁球场 3-2 MVP
/finish' > quick-match.txt
```

使用时复制粘贴即可。

---

## 📞 需要帮助？

- 查看详细文档：`WECHAT_BOT_IDEA.md`
- 查看优化建议：`OPTIMIZATION_SUGGESTIONS.md`
- 查看命令帮助：在微信中发送 `/help`

---

## ✅ 检查清单

使用前确认：

- [ ] 已安装 Node.js
- [ ] 已安装依赖包
- [ ] 已配置微信昵称
- [ ] 已扫码登录
- [ ] 已测试发送消息

开始使用吧！🚀⚽
